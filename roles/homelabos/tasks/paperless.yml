---
  - hosts: localhost
    tasks:
    - name: paperless
      docker_image:
        image: danielquinn/paperless
        restart: always
        ports:
          - "8325:8000"
        healthcheck:
          test: ["CMD", "curl" , "-f", "http://localhost:8000"]
          interval: 30s
          timeout: 10s
          retries: 5
        volumes:
          - /var/homelabos/paperless/data:/usr/src/paperless/data
          - /var/homelabos/paperless/media:/usr/src/paperless/media
          - /mnt/nas/Documents/consume:/consume
          - /mnt/nas/Documents/export:/export
        environment:
          - PAPERLESS_OCR_LANGUAGES=
          - PAPERLESS_PASSPHRASE=homelabos
        command: ["runserver", "--insecure", "--noreload", "0.0.0.0:8000"]
        labels:
          - "traefik.enable=true"
          - "traefik.http.frontend.rule=Host:paperless.{{ domain }}"
          - "traefik.http.frontend.headers.customFrameOptionsValue=ALLOW-FROM http://{{ domain }}"
          - "traefik.http.frontend.headers.customFrameOptionsValue=ALLOW-FROM https://{{ domain }}"
          - "traefik.http.protocol={{ protocol }}"
          - "traefik.http.port=8000"
          - "traefik.tor.frontend.rule=Host:paperless.{{ tor_domain }}"
          - "traefik.tor.protocol={{ protocol }}"
          - "traefik.tor.port=8000"

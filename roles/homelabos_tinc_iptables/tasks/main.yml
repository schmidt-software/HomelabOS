---
- name: Install ipTables-persistent
  apt:
    name: iptables-persistent

- name: Set ipTables port 2223->22
  iptables:
    table: nat
    chain: PREROUTING
    protocol: tcp
    destination_port: 2223
    to_destination: 10.0.0.1:22
    jump: DNAT
  become: yes

- name: Set ipTables port 80->80
  iptables:
    table: nat
    chain: PREROUTING
    protocol: tcp
    destination_port: 80
    to_destination: 10.0.0.1:80
    jump: DNAT
  become: yes

- name: Set ipTables port 443->443
  iptables:
    table: nat
    chain: PREROUTING
    protocol: tcp
    destination_port: 443
    to_destination: 10.0.0.1:443
    jump: DNAT
  become: yes

- name: Set ipTables port 25->25
  iptables:
    table: nat
    chain: PREROUTING
    in_interface: eth0
    protocol: tcp
    destination_port: 25
    to_destination: 10.0.0.1:25
    jump: DNAT
  become: yes

- name: Set ipTables port 2223->22
  iptables:
    table: nat
    chain: PREROUTING
    protocol: tcp
    destination_port: 143
    to_destination: 10.0.0.1:143
    jump: DNAT
  become: yes

- name: Set ipTables port 587->587
  iptables:
    table: nat
    chain: PREROUTING
    protocol: tcp
    destination_port: 587
    to_destination: 10.0.0.1:587
    jump: DNAT
  become: yes

- name: Set ipTables port 998->998
  iptables:
    table: nat
    chain: PREROUTING
    protocol: tcp
    destination_port: 998
    to_destination: 10.0.0.1:998
    jump: DNAT
  become: yes

- name: Set ipTables port 4190->4190
  iptables:
    table: nat
    chain: PREROUTING
    protocol: tcp
    destination_port: 4190
    to_destination: 10.0.0.1:4190
    jump: DNAT
  become: yes

- name: Set ipTables post-routing masquerade
  iptables:
    table: nat
    chain: POSTROUTING
    jump: MASQUERADE
  become: yes

- name: Persist iptable routing across reboots
  shell: iptables-save > /etc/iptables/rules.v4
